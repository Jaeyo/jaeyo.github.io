{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/bash-is-not-async/","webpackCompilationHash":"4620f6cdacfa6786a2b3","result":{"data":{"site":{"siteMetadata":{"title":"Hello, there","author":"Jaeyo"}},"allMarkdownRemark":{"edges":[{"node":{"fields":{"slug":"/look-back-on-8-years-2/"},"frontmatter":{"title":"8년 간의 개발자 생활 회고 (2)","tags":["tech","look_back"]}}},{"node":{"fields":{"slug":"/look-back-on-8-years-1/"},"frontmatter":{"title":"8년 간의 개발자 생활 회고 (1)","tags":["tech","look_back"]}}},{"node":{"fields":{"slug":"/contribute-code-into-telegraf/"},"frontmatter":{"title":"오픈소스 프로젝트에 코드 기여한 이야기","tags":["tech","open source","telegraf"]}}},{"node":{"fields":{"slug":"/naming-is-important/"},"frontmatter":{"title":"작명의 중요성","tags":["daily"]}}},{"node":{"fields":{"slug":"/move-to-another-place/"},"frontmatter":{"title":"새로운 곳으로 이사","tags":["daily"]}}},{"node":{"fields":{"slug":"/git-delete-branch-and-push/"},"frontmatter":{"title":"Git - branch 삭제 후 push","tags":["tech","git"]}}},{"node":{"fields":{"slug":"/bash-is-not-async/"},"frontmatter":{"title":"오늘의 삽질 - 괜히 Bash 만 의심했다.","tags":["tech","trouble shooting"]}}},{"node":{"fields":{"slug":"/better-than-yesterday/"},"frontmatter":{"title":"연봉과 연차의 무게","tags":["tech","career"]}}},{"node":{"fields":{"slug":"/error-while-building-qmk_firmware/"},"frontmatter":{"title":"qmk_firmware 빌드 시에 chibios 관련 에러 발생","tags":["tech","keyboard"]}}},{"node":{"fields":{"slug":"/reselect/"},"frontmatter":{"title":"reselect","tags":["tech"]}}},{"node":{"fields":{"slug":"/aws-api-ip-based-access-control/"},"frontmatter":{"title":"AWS API, IP 기반으로 접근 제한하기","tags":["tech","aws"]}}},{"node":{"fields":{"slug":"/shame/"},"frontmatter":{"title":"조중균의 세계를 읽었다.","tags":["daily"]}}},{"node":{"fields":{"slug":"/snut-2006-3/"},"frontmatter":{"title":"2006년의 서울과학기술대학교 (3)","tags":["daily"]}}},{"node":{"fields":{"slug":"/snut-2006-2/"},"frontmatter":{"title":"2006년의 서울과학기술대학교 (2)","tags":["daily"]}}},{"node":{"fields":{"slug":"/snut-2006-1/"},"frontmatter":{"title":"2006년의 서울과학기술대학교 (1)","tags":["daily"]}}},{"node":{"fields":{"slug":"/how-to-develop-ridistory-frontend/"},"frontmatter":{"title":"리디스토리 프론트엔드 개발기","tags":["tech","react"]}}},{"node":{"fields":{"slug":"/life-with-rainbow-colors/"},"frontmatter":{"title":"삶은 무지개 색이어야 한다.","tags":["daily"]}}},{"node":{"fields":{"slug":"/drive/"},"frontmatter":{"title":"운전을 하고 싶다","tags":["daily"]}}},{"node":{"fields":{"slug":"/mariadb-multi-source-replication/"},"frontmatter":{"title":"mariadb multi source replication","tags":["tech","mariadb"]}}},{"node":{"fields":{"slug":"/too-many-open-files/"},"frontmatter":{"title":"Too many open files","tags":["tech","trouble shooting"]}}},{"node":{"fields":{"slug":"/weird-requests/"},"frontmatter":{"title":"아닌 밤중에 리퀘스트가 튄다?","tags":["tech","trouble shooting"]}}},{"node":{"fields":{"slug":"/spaces/"},"frontmatter":{"title":"겹겹의 공간들","tags":["daily"]}}},{"node":{"fields":{"slug":"/job-interview/"},"frontmatter":{"title":"이직 면접 이야기","tags":["career"]}}}]},"markdownRemark":{"id":"6a3e8637-fdef-5ab2-98b6-ff1e31af96c4","excerpt":"회사에서 만들어놓은 쉘 스크립트가 있었다. 필요한 패키지를 다운로드받아 설치하고 설정파일을 고치고 systemctl 로 띄우는 내용의 스크립트로 대략적인 모양새는 아래와 같다. 위의 스크립트에 따르면 아래의 로직을 타게 된다. curl 로 blabla.deb 다운로드 dpkg…","html":"<p>회사에서 만들어놓은 쉘 스크립트가 있었다. 필요한 패키지를 다운로드받아 설치하고 설정파일을 고치고 systemctl 로 띄우는 내용의 스크립트로 대략적인 모양새는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">install_blabla</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token assign-left variable\">dest</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>mktemp /tmp/blabla_XXXX.deb<span class=\"token variable\">)</span></span>\n\t<span class=\"token function\">curl</span> -fsSL http://blabla.com/blabla.deb -o <span class=\"token variable\">$dest</span>\n\tdpkg -i <span class=\"token variable\">$dest</span>\n\t<span class=\"token function\">rm</span> -f <span class=\"token variable\">$dest</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function-name function\">install_conf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">curl</span> -fsSL http://blabla.com/blabla.conf -o /etc/blabla/blabla.conf\n\t<span class=\"token function\">sed</span> -i -e <span class=\"token string\">\"...\"</span> /etc/blabla/blabla.conf\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function-name function\">start_blabla</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tsystemctl start blabla\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function-name function\">do_install</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tinstall_blabla\n\tinstall_conf\n\tstart_blabla\n<span class=\"token punctuation\">}</span>\n\ndo_install</code></pre></div>\n<p>위의 스크립트에 따르면 아래의 로직을 타게 된다.</p>\n<ol>\n<li>curl 로 blabla.deb 다운로드</li>\n<li>dpkg 로 blabla.deb 설치</li>\n<li>curl 로 blabla.conf 다운로드</li>\n<li>sed 로 blabla.conf 내용 수정</li>\n<li>systemctl 로 blabla 시작</li>\n</ol>\n<p>이 로직대로 정상 작동 한다면 blabla는 수정된 설정파일을 정상적으로 물고 떠야한다. 하지만 blabla가 이상 동작을 한다는 이슈가 리포팅되었고, 확인 결과 수정된 설정파일이 아니라 기본 설정 파일을 물고 뜨는 것으로 의심이 되는 상황이었다.</p>\n<p>하지만 아무리 확인을 해봐도 설정파일은 정상적으로 수정되어 있었고, 그렇다고 다른 path의 설정 파일을 물고 있는 상황도 아니었다.</p>\n<p>순간 머리속을 스치는 의심 하나,</p>\n<p>“모종의 알 수 없는 이유로 blabla.conf 파일 다운로드가 채 끝나기 전에 다음 구문이 실행되었다면?”</p>\n<p>그래서 blabla를 재기동해보았고 정상적으로 수정된 설정 파일을 잘 물고 뜨는 걸 확인할 수 있었다. 갑작스레 혼란이 밀려왔다.</p>\n<p>“아니, 무슨 bash가 node.js 도 아니고 상황에 따라서 curl 명령이 끝나기 전에 다음 구문으로 넘어갈 수가 있나? 무슨 bash가 async야?”</p>\n<p>혹시나 싶어서 구글링을 해봤지만 걸리는 건 없었고 사건이 터진 이유를 알 수 없어 혼란스러워 하던 즈음, 옆 동료 분이 원인을 정확하게 짚어주셨다.</p>\n<p>“이거 dpkg 로 설치하고 바로 뜨는 것 같은데요.”</p>\n<p>문제는 당연히 bash 가 async 로 동작했다거나 그런게 아니었고 ubuntu 기준으로 dpkg로 설치되는 패키지는 서비스가 포함되어 있으면 자동으로 enabled &#x26;&#x26; started 되는 현상이었다.</p>\n<p>괜히 의심했던 것 같아 bash 에게 사과를…</p>","fields":{"slug":"/bash-is-not-async/"},"frontmatter":{"title":"오늘의 삽질 - 괜히 Bash 만 의심했다.","date":"August 13, 2019","description":null,"tags":["tech","trouble shooting"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"next":{"fields":{"slug":"/git-delete-branch-and-push/"},"frontmatter":{"title":"Git - branch 삭제 후 push"}},"previous":{"fields":{"slug":"/better-than-yesterday/"},"frontmatter":{"title":"연봉과 연차의 무게"}},"slug":"/bash-is-not-async/"}}}